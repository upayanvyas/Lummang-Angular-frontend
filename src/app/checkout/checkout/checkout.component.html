<body style="background-color:#DCDCDC;">

    <app-header2></app-header2>
    <div class="page-wrapper" *ngIf="cart.length>0">
        <main class="main checkout">
            <!-- Start of Breadcrumb -->
            <nav class="breadcrumb-nav" style="margin-top: -25px;">
                <div style="width: 100%;">
                    <ul class="breadcrumb shop-breadcrumb bb-no" style="background-color: #DCDCDC;">
                        <li class="passed"><a href="Cart/cartdetails">Shopping Cart</a></li>
                        <li class="text-danger"><a href="checkout">Checkout</a></li>
                        <li><a>Payment Mode</a></li>
                    </ul>
                </div>
            </nav>
            <!-- End of Breadcrumb -->


            <!-- Start of PageContent -->
            <div class="page-content">

                <div class="container">

                    <div class="coupon-toggle">
                        <i class="w-icon-sale" style="font-size: 17px;"></i>
                        Have a coupon? <a href="#" class="show-coupon font-weight-bold text-uppercase text-danger
                        ">Enter your
                            code</a>
                    </div>
                    <div class="coupon-content mb-4">
                        <p>If you have a coupon code, please apply it below.</p>
                        <div class="input-wrapper-inline">
                            <input type="text" name="coupon_code" class="form-control form-control-md mr-1 mb-2"
                                placeholder="Coupon code" id="coupon_code">

                            <div class="btn-wrap show-code-action">
                                <a href="#" class="btn btn-danger btn-outline btn-sm btn-ellipse">Apply</a>
                            </div>
                        </div>

                    </div>

                    <form class="form checkout-form" [formGroup]="loginform" (ngSubmit)="pay()">
                        <div class="row mb-12">
                            <div class="col-lg-2" style="background-color: white; height: 35px; border-radius: 6px; ">
                                <div *ngIf="user.length==0">
                                    <h3 style="color: red; text-align:center; padding: 6px;">New Address</h3>
                                </div>
                                <div *ngIf="user.length>0">
                                    <h3 style="color: red; text-align:center; padding: 6px;">Saved Address <a
                                            style="color: black;">{{countuseraddress}}</a></h3>

                                    <button href="#" class="btn btn-danger " (click)="open(content)">Add New
                                        Address</button>

                                    <!-- Button trigger modal -->
                                </div>
                            </div>

                            <div class="col-lg-6 mb-4 sticky-sidebar-wrapper">
                                <div class="order-summary-wrapper sticky-sidebar" style="background-color: white;">
                                    <div *ngIf="user.length==0">
                                        <div class="order-summary">

                                            <div class="row gutter-sm">
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label>Select Country *</label>
                                                        <input type="text" class="form-control form-control-md"
                                                            formControlName="country" required="">
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Full Name*</label>
                                                        <input type="text" class="form-control form-control-md"
                                                            formControlName="fullname" required>
                                                        <span
                                                            *ngIf="loginform.get('fullname').invalid && loginform.get('fullname').touched"
                                                            class="text-danger">Fullname required **</span>

                                                    </div>

                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group">

                                                        <label>Email *</label>
                                                        <input type="email" class="form-control form-control-md"
                                                            formControlName="email">

                                                        <div class=""
                                                            *ngIf="loginform.get('email').invalid && loginform.get('email').touched">

                                                            <div class="error"
                                                                *ngIf="loginform.get('email').errors.required"
                                                                class="text-danger">Email is required **
                                                            </div>
                                                            <div class="error"
                                                                *ngIf="loginform.get('email').errors.email"
                                                                class="text-danger">Enter a valid Email</div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Phoneno *</label>
                                                        <input type="phoneNo" class="form-control" id="phoneNo"
                                                            name="phoneno" formControlName="phoneno" minlength="10"
                                                            maxlength="10" required>

                                                        <div class=""
                                                            *ngIf="loginform.get('phoneno').invalid && loginform.get('phoneno').touched">

                                                            <div class="error"
                                                                *ngIf="loginform.get('phoneno').errors.required"
                                                                class="text-danger">Mobile number is required **
                                                            </div>
                                                            <div class="error"
                                                                *ngIf="loginform.get('phoneno').errors.pattern"
                                                                class="text-danger">Enter a valid mobile number</div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Postal Code *</label>
                                                        <input type="text" class="form-control form-control-md"
                                                            formControlName="pincode" required="">
                                                        <span
                                                            *ngIf="loginform.get('pincode').invalid && loginform.get('pincode').touched"
                                                            class="text-danger">Postal Code required **</span>

                                                    </div>

                                                    <div class="form-group mt-3">
                                                        <label for="order-notes">Address (Area and Street)</label>
                                                        <textarea class="form-control mb-0" id="order-notes"
                                                            name="order-notes" formControlName="address" cols="30"
                                                            rows="4"
                                                            placeholder="Notes about your order, e.g special notes for delivery"></textarea>
                                                        <div class=""
                                                            *ngIf="loginform.get('address').invalid && loginform.get('address').touched">

                                                            <div class="error"
                                                                *ngIf="loginform.get('address').errors.required"
                                                                class="text-danger">Address is required **
                                                            </div>
                                                            <div class="error"
                                                                *ngIf="loginform.get('address').errors.minlength"
                                                                class="text-danger">Minimum address length 7</div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>State *</label>
                                                        <input type="text" class="form-control form-control-md"
                                                            formControlName="state" name="state" required="">
                                                    </div>

                                                    <div class="form-group">
                                                        <label>City *</label>
                                                        <input type="text" class="form-control form-control-md"
                                                            formControlName="city" name="city" required="">
                                                    </div>
                                                </div>
                                            </div>


                                            <input type="radio" class="checked" value="default"
                                                formControlName="addresstype" name="addresstype">
                                            <label class="control control--checkbox" style="padding: 5px;">
                                                <!-- react-text: 628 -->Use this as my default Shipping Address
                                                <!-- /react-text -->
                                                <div class="control__indicator"></div>
                                            </label>
                                            <div class="form-group place-order pt-6">
                                                <button type="submit" style="border-radius: 23px;"
                                                    class="btn btn-danger btn-block btn-sm btn-rounded"
                                                    [disabled]="loginform.invalid" (click)="useraddress()">Place
                                                    Order</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div *ngIf="user">
                                        <div *ngFor="let data of user; index as i">
                                            <div class="card">

                                                <div class="card-body">
                                                    <button class="badge badge-success" style="margin-left:425px"
                                                        type="submit" class="btn" (click)=" deleteaddress()"><i
                                                            class="fas fa-trash"></i></button>
                                                    <h5 class="card-title">{{data.fullname}}</h5>
                                                    <h5 class="card-title">{{data.address}},</h5>
                                                    <p class="card-text">
                                                        {{data.city}}-{{data.pincode}},{{data.state}},{{data.country}}
                                                    </p>
                                                    <h5 class="card-title"><b>+91-{{data.phoneno}}</b></h5>
                                                    <a class="badge badge-success" type="submit" class="btn"
                                                        (click)="opendetails(data)"><i class="fas fa-edit"></i></a>
                                                    <button href="#" class="btn btn-danger"
                                                        (click)="createOrder(data)">SHIP TO THIS ADDRESS </button>

                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <div class="col-lg-4 mb-4 sticky-sidebar-wrapper">
                                <div class="order-summary-wrapper sticky-sidebar" style="background-color: white;">

                                    <div class="dropdown cart-dropdown cart-offcanvas float-right">

                                        <a href="cart#" class="cart-toggle label-down link">

                                            <span class="cart-label">
                                                <h3 style="color: red;">Edit</h3>
                                            </span>
                                        </a>
                                    </div>


                                    <div class="heading prl20 " style="color:green">
                                        <!-- react-text: 890 -->{{totalquantity}} Items in your Bag
                                        <!-- /react-text --><span class="details-info">
                                            <!-- react-text: 985 -->
                                            <!-- /react-text -->
                                        </span>
                                    </div>
                                    <hr>
                                    <div id="text">
                                        <div class="order-summary" *ngFor="let data of cart">


                                            <div class="shipping-items-details-section">
                                                <div>
                                                    <div class="heading prl20 open">
                                                        <!-- react-text: 458 -->
                                                        <!-- /react-text --><span class="details-info">

                                                            <svg width="0px" height="0px">
                                                                <path
                                                                    d="M12 1.02L10.978 0 6 4.973 1.011 0 0 1.008l5.494 5.477L6 7l.506-.515z"
                                                                    fill="#FC2779" fill-rule="nonzero"></path>
                                                            </svg></span>
                                                    </div>
                                                    <div class="bag-details-box-container">
                                                        <div class="bag-details-box">
                                                            <div class="media item">

                                                                <img src="https://demo22.appman.in/{{data.itemid.coverphoto[0].coverphoto[0].filename}}"
                                                                    alt="product" height="64" width="64" />
                                                                <div class="media-body details">
                                                                    <div class="product-name">
                                                                        <div class="product-name"
                                                                            style="width: 200px; padding: 5px;">
                                                                            {{data.itemid.itemname}}</div>
                                                                    </div>

                                                                    <div class="product-qty-price">
                                                                        <div class="product-quantity float-left"
                                                                            style="margin: 5px;">
                                                                            <!-- react-text: 474 -->Qty : &nbsp;
                                                                            <!-- /react-text --><span>{{data.quantity}}</span>
                                                                        </div>

                                                                        <div class="product-price float-right"><span
                                                                                class="selling-price"><del
                                                                                    class="old-price"
                                                                                    style="padding: 3px;">₹{{data.itemid.mrp
                                                                                    * data.quantity}}</del></span><span
                                                                                class="actual-price"><ins
                                                                                    class="new-price"
                                                                                    style="padding-right: 9px;">₹{{data.itemid.price
                                                                                    * data.quantity}}</ins>
                                                                                <!-- /react-text --></span></div>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="payment-details-tbl prl20 payment-reward-row">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <hr>




                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>

                                    <tfoot>
                                        <tr class="shipping-methods">
                                            <td colspan="2" class="text-left">
                                                <label for="flat-rate" style="font-size: 14px;">Sub Total :
                                                    {{totalprice | currency:'INR'}}</label>


                                                <ul id="shipping-method" class="mb-4">

                                                    <li>
                                                        <label for="flat-rate" style="font-size: 14px;">Discount
                                                            : {{-0 |currency:'INR'}}</label>
                                                    </li>
                                                    <li>
                                                        <div>

                                                            <label for="flat-rate" style="font-size: 14px;">Delivery
                                                                Charge
                                                                : {{0 |currency:'INR'}}</label>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </td>
                                        </tr>
                                        <hr>
                                        <tr class="order-total">

                                            <th style="color: maroon;">
                                                Grand Total
                                            </th>
                                            <td>
                                                <b>: {{totalprice | currency:'INR'}}</b>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </div>
                            </div>
                        </div>
                    </form>


                </div>
            </div>
            <!-- End of PageContent -->

            <div class="dropdown cart-dropdown cart-offcanvas float-right">
                <a href="#edit" class="cart-toggle label-down link"></a>
                <div class="dropdown-box">
                    <div class="cart-header">
                        <span>Shopping Cart ({{totalquantity}})</span>
                        <a href="cart#" class="btn-close">Close<i class="w-icon-long-arrow-right"></i></a>
                    </div>
                    <div *ngIf="cart.length>0">
                        <div id="text">
                            <div class="product product-cart" *ngFor="let cart of cart">
                                <div class="product-detail">
                                    <a href="itemdetails/{{cart.itemid._id}}" class="product-name"
                                        style="color: black;">{{cart.itemid.itemname}}</a>
                                    <div class="price-box">
                                        <del class="old-price">{{cart.mrp *cart.quantity | currency:'INR'}}</del>
                                        <span class="product-price" style="padding: 3px;">{{cart.price *cart.quantity |
                                            currency:'INR'}}</span>
                                    </div>

                                    <div class="input-group ">
                                        <a class="btn-product-icon " style="border-radius: 35px; "
                                            title="increase quantity" type="submit"
                                            (click)="incquantity(cart._id,cart.quantity)">
                                            <h5 style="margin-top: 5px;">+</h5>
                                        </a>
                                        <a style="font-size: 13px;">{{cart.quantity}}</a>

                                        <a class="btn-product-icon " style="border-radius: 35px; "
                                            title="decrease quantity" type="submit"
                                            (click)="decquantity(cart._id,cart.quantity-1)">
                                            <h2>-</h2>
                                        </a>

                                    </div>
                                    <hr>
                                </div>

                                <figure class="product-media">
                                    <a href="itemdetails/{{cart.itemid._id}}">
                                        <img src="http://localhost:4000/{{cart.itemid.itemImages[0].filename}}"
                                            alt="product" height="84" width="94" />
                                    </a>
                                </figure>


                                <button class="btn btn-link btn-close" style="align-items: center; margin-right: 9px;"
                                    aria-label="button" (click)="deletecart(cart._id)" type="submit">
                                    <i style="margin-left: -3px;margin-top: -2px;" class="far fa-trash"></i>
                                </button>


                            </div>

                            <!-- End of Dropdown Box -->


                        </div>

                        <hr>
                        <div class="cart-total" style="margin-top: -13px;">
                            <label>Bagtotal:</label>
                            <span class="price">{{mrptotalprice | currency:'INR'}}</span>
                        </div>
                        <div class="cart-total" style="margin-top: -33px; color: maroon;">
                            <label>Bag Discount:</label>
                            <span class="price">{{mrptotalprice - totalprice | currency:'INR'}}</span>
                        </div>
                        <div class="cart-total" style="margin-top: -33px;">
                            <label>Subtotal:</label>
                            <span class="price">{{totalprice | currency:'INR'}}</span>
                        </div>
                        <div class="cart-total" style="margin-top: -33px;">
                            <label>Shipping Charge:</label>
                            <span class="price">
                                <h5>Free</h5>
                            </span>
                        </div>

                        <div class="cart-total" style="margin-top: -33px;">
                            <label>Grand:</label>
                            <span class="price">{{totalprice | currency:'INR'}}</span>
                        </div>
                        <div class="cart-action" style="margin-top: -17px;">
                            <a href="Cart/cartdetails" class="btn btn-primary  btn-rounded"
                                style="border-radius: 23px;">View Cart</a>
                            <a href="checkout" class="btn btn-danger  btn-rounded"
                                style="border-radius: 23px;">Checkout</a>
                        </div>
                    </div>


                    <div *ngIf="cart.length==0" class="alert alert-warning" role="alert">
                        hii your cart is empty
                    </div>
                </div>


            </div>
            <!-- End of Header Top -->
        </main>
        <!-- End of Main -->
        <app-footer1></app-footer1>
    </div>
    <!-- End of Page Wrapper -->

    <div *ngIf="cart.length==0" role="alert">
        <div class="page-content error-404">
            <div class="container">
                <div class="banner">
                    <figure>
                        <img src="../../../assets/assets/images/open-box.png" alt="Error 404" id="emptycheckout" />
                    </figure>
                    <div class="banner-content text-center">
                        <h2 class="banner-title">
                            <span class="text-secondary">Hey,</span> it feels so light !
                        </h2>
                        <p class="text-dark">There is nothing in your cart .Let's add some item's</p>
                        <a href="home" class="btn btn-dark btn-rounded btn-icon-right">SHOP ITEM FROM HOME<i
                                class="w-icon-long-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <ng-template #content let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title" >New Address</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')">X</button>
        </div>
        <div class="modal-body">
            <form class="form checkout-form" [formGroup]="loginform" (ngSubmit)=" Modelcheckout()">
                <div class="row mb-12">
                    <div class="col-lg-12 mb-4 sticky-sidebar-wrapper">
                        <div class="order-summary-wrapper sticky-sidebar" style="background-color: white;">
                            <div class="order-summary">
                                <div class="row gutter-sm">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Select Country*</label>
                                            <input type="text" class="form-control form-control-md"
                                                formControlName="country" required="">
                                        </div>
                                        <div class="form-group">
                                            <label>Full Name*</label>
                                            <input type="text" class="form-control form-control-md"
                                                formControlName="fullname" required>
                                            <span
                                                *ngIf="loginform.get('fullname').invalid && loginform.get('fullname').touched"
                                                class="text-danger">Fullname required **</span>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Email *</label>
                                            <input type="email" class="form-control form-control-md"
                                                formControlName="email">

                                            <div class=""
                                                *ngIf="loginform.get('email').invalid && loginform.get('email').touched">

                                                <div class="error" *ngIf="loginform.get('email').errors.required"
                                                    class="text-danger">Email is required **
                                                </div>
                                                <div class="error" *ngIf="loginform.get('email').errors.email"
                                                    class="text-danger">Enter a valid Email</div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label>Phoneno *</label>
                                            <input type="phoneNo" class="form-control" id="phoneNo" name="phoneno"
                                                formControlName="phoneno" minlength="10" maxlength="10" required>

                                            <div class=""
                                                *ngIf="loginform.get('phoneno').invalid && loginform.get('phoneno').touched">

                                                <div class="error" *ngIf="loginform.get('phoneno').errors.required"
                                                    class="text-danger">Mobile number is required **
                                                </div>
                                                <div class="error" *ngIf="loginform.get('phoneno').errors.pattern"
                                                    class="text-danger">Enter a valid mobile number</div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Postal Code *</label>
                                            <input type="text" class="form-control form-control-md"
                                                formControlName="pincode" required="">
                                            <span
                                                *ngIf="loginform.get('pincode').invalid && loginform.get('pincode').touched"
                                                class="text-danger">Postal Code required **</span>

                                        </div>

                                        <div class="form-group mt-3">
                                            <label for="order-notes">Address (Area and Street)</label>
                                            <textarea class="form-control mb-0" id="order-notes" name="order-notes"
                                                formControlName="address" cols="30" rows="4"
                                                placeholder="Notes about your order, e.g special notes for delivery"></textarea>
                                            <div class=""
                                                *ngIf="loginform.get('address').invalid && loginform.get('address').touched">

                                                <div class="error" *ngIf="loginform.get('address').errors.required"
                                                    class="text-danger">Address is required **
                                                </div>
                                                <div class="error" *ngIf="loginform.get('address').errors.minlength"
                                                    class="text-danger">Minimum address length 7</div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>State *</label>
                                            <input type="text" class="form-control form-control-md"
                                                formControlName="state" required="">
                                        </div>

                                        <div class="form-group">
                                            <label>City *</label>
                                            <input type="text" class="form-control form-control-md"
                                                formControlName="city" required="">
                                        </div>
                                    </div>
                                </div>

                                <input type="radio" class="checked" value="default" formControlName="addresstype"
                                    name="addresstype">
                                <label class="control control--checkbox" style="padding: 5px;">
                                    <!-- react-text: 628 -->Use this as my default Shipping Address
                                    <!-- /react-text -->
                                    <div class="control__indicator"></div>
                                </label>
                                <div class="form-group place-order pt-6">
                                    <button type="submit" style="border-radius: 23px;"
                                        class="btn btn-danger btn-block btn-sm btn-rounded"
                                        [disabled]="loginform.invalid" (click)="useraddress()">Place Order</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </ng-template>

    <!--update address-->
    <ng-template #contentdetails let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h4 class="modal-title" id="modal-basic-title">Edit Address</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')">X</button>
        </div>
        <div class="modal-body">
            <form class="form checkout-form">
                <div class="row mb-12">
                    <div class="col-lg-12 mb-4 sticky-sidebar-wrapper">
                        <div class="order-summary-wrapper sticky-sidebar" style="background-color: white;">
                            <div class="order-summary">
                                <div class="row gutter-sm">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Select Country *</label>
                                            <input type="text" class="form-control form-control-md" #country
                                                [(ngModel)]="updateaddress.country" name="country" required="">
                                        </div>
                                        <div class="form-group">
                                            <label>Full Name*</label>
                                            <input type="text" class="form-control form-control-md" #fullname
                                                [(ngModel)]="updateaddress.fullname" name="fullname" required>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Email *</label>
                                            <input type="email" class="form-control form-control-md" #email
                                                [(ngModel)]="updateaddress.email" name="email">
                                        </div>
                                        <div class="form-group">
                                            <label>Phoneno *</label>
                                            <input type="phoneNo" class="form-control" id="phoneNo" #phoneno
                                                [(ngModel)]="updateaddress.phoneno" name="phoneno" minlength="10"
                                                maxlength="10" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Postal Code *</label>
                                            <input type="text" class="form-control form-control-md"
                                                [(ngModel)]="updateaddress.pincode" name="pincode" required="">
                                        </div>
                                        <div class="form-group mt-3">
                                            <label for="order-notes">Address (Area and Street)</label>
                                            <textarea class="form-control mb-0" id="order-notes"
                                                [(ngModel)]="updateaddress.address" name="address" cols="30" rows="4"
                                                placeholder="Notes about your order, e.g special notes for delivery"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label>State *</label>
                                            <input type="text" class="form-control form-control-md"
                                                [(ngModel)]="updateaddress.state" name="state" required="">
                                        </div>
                                        <div class="form-group">
                                            <label>City *</label>
                                            <input type="text" class="form-control form-control-md"
                                                [(ngModel)]="updateaddress.city" name="city" required="">
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" class="form-control form-control-md"
                                    [(ngModel)]="updateaddress.customerid" name="customerid" required="">
                                <input type="hidden" class="form-control form-control-md"
                                    [(ngModel)]="updateaddress._id" name="_id" required="">
                                <div class="form-group place-order pt-6">
                                    <button type="submit" style="border-radius: 23px;"
                                        class="btn btn-danger btn-block btn-sm btn-rounded"
                                        (click)="updateuseraddress()">Place Order</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </ng-template>

    <!-- Start of Scroll Top -->
    <a id="scroll-top" class="scroll-top" href="#top" title="Top" role="button"> <i class="w-icon-angle-up"></i> <svg
            version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 70 70">
            <circle id="progress-indicator" fill="transparent" stroke="#000000" stroke-miterlimit="10" cx="35" cy="35"
                r="34" style="stroke-dasharray: 16.4198, 400;"></circle>
        </svg> </a>
    <!-- End of Scroll Top -->



    <!-- Plugin JS File -->